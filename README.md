# TC-ACApp å¤šäººå®æ—¶å¯¹æˆ˜æ¸¸æˆ

## é¡¹ç›®ç®€ä»‹

TC-ACAppæ˜¯ä¸€ä¸ªåŸºäºDjango + WebSocketçš„å¤šäººå®æ—¶å¯¹æˆ˜æ¸¸æˆï¼Œä¸“ä¸ºè…¾è®¯é¢è¯•å‡†å¤‡å¼€å‘ã€‚è¯¥é¡¹ç›®å±•ç¤ºäº†å…¨æ ˆå¼€å‘èƒ½åŠ›ï¼ŒåŒ…å«å®Œæ•´çš„ç”¨æˆ·ç³»ç»Ÿã€å®æ—¶é€šä¿¡ã€æ¸¸æˆåŒ¹é…ã€æŠ€èƒ½æˆ˜æ–—ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚
### ->  [tc_acapp æ¸¸æˆé“¾æ¥](https://app7581.acapp.acwing.com.cn/) <-

## æŠ€æœ¯ç‰¹è‰²

### ğŸ¯ æ ¸å¿ƒæŠ€æœ¯æ ˆ
- **åç«¯**: Django 4.2.24 + Django Channels (WebSocket)
- **æ•°æ®åº“**: SQLite3 + Redisç¼“å­˜
- **å‰ç«¯**: åŸç”ŸJavaScript + HTML5 Canvas
- **é€šä¿¡**: Thrift RPC + WebSocketå®æ—¶é€šä¿¡
- **éƒ¨ç½²**: uWSGI + Nginx

### ğŸ® æ¸¸æˆç‰¹æ€§
- **3äººå®æ—¶å¯¹æˆ˜**: åŸºäºç§¯åˆ†çš„æ™ºèƒ½åŒ¹é…ç³»ç»Ÿ
- **æŠ€èƒ½æˆ˜æ–—**: ç«çƒæœ¯ã€é—ªçƒæŠ€èƒ½ï¼Œå¸¦å†·å´æ—¶é—´æœºåˆ¶
- **åŠ¨æ€è¡€é‡**: å®æ—¶ä¼¤å®³è®¡ç®—ä¸è§†è§‰åé¦ˆ
- **ç§¯åˆ†æ’ä½**: èƒœè´Ÿå½±å“ç©å®¶ç§¯åˆ†ï¼Œç±»ä¼¼ELOç³»ç»Ÿ
- **å®æ—¶èŠå¤©**: æ¸¸æˆå†…å³æ—¶é€šä¿¡åŠŸèƒ½

## ç³»ç»Ÿæ¶æ„

### åç«¯æ¶æ„
```
â”œâ”€â”€ tc_acapp/           # Djangoé¡¹ç›®é…ç½®
â”œâ”€â”€ game/               # æ¸¸æˆä¸»åº”ç”¨
â”‚   â”œâ”€â”€ models/         # ç©å®¶æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ consumers/      # WebSocketæ¶ˆè´¹è€…
â”‚   â”œâ”€â”€ views/          # HTTPè§†å›¾å¤„ç†
â”‚   â””â”€â”€ static/         # æ¸¸æˆå‰ç«¯èµ„æº
â”œâ”€â”€ match_system/       # åŒ¹é…ç³»ç»ŸæœåŠ¡
â”‚   â”œâ”€â”€ thrift/         # RPCæ¥å£å®šä¹‰
â”‚   â””â”€â”€ src/            # åŒ¹é…ç®—æ³•å®ç°
```

### æ ¸å¿ƒæ¨¡å—

#### 1. ç”¨æˆ·ç³»ç»Ÿ
- **æ³¨å†Œ/ç™»å½•**: å®Œæ•´çš„ç”¨æˆ·è®¤è¯æœºåˆ¶
- **ç©å®¶æ¨¡å‹**: ç”¨æˆ·ä¿¡æ¯ã€å¤´åƒã€ç§¯åˆ†ç®¡ç†
- **å®‰å…¨éªŒè¯**: å¯†ç åŠ å¯†ã€ä¼šè¯ç®¡ç†

#### 2. åŒ¹é…ç³»ç»Ÿ
- **æ™ºèƒ½åŒ¹é…**: åŸºäºç§¯åˆ†å·®å€¼å’Œç­‰å¾…æ—¶é—´çš„åŒ¹é…ç®—æ³•
- **Thrift RPC**: é«˜æ€§èƒ½çš„æœåŠ¡é—´é€šä¿¡
- **æˆ¿é—´ç®¡ç†**: åŠ¨æ€åˆ›å»º3äººå¯¹æˆ˜æˆ¿é—´

#### 3. å®æ—¶æ¸¸æˆ
- **WebSocketé€šä¿¡**: ä½å»¶è¿Ÿçš„å®æ—¶æ•°æ®åŒæ­¥
- **Canvasæ¸²æŸ“**: æµç•…çš„æ¸¸æˆç”»é¢å’ŒåŠ¨ç”»æ•ˆæœ
- **çŠ¶æ€åŒæ­¥**: ç©å®¶ä½ç½®ã€æŠ€èƒ½ã€ä¼¤å®³çš„å®æ—¶åŒæ­¥

#### 4. æ¸¸æˆç©æ³•
```
// æŠ€èƒ½ç³»ç»Ÿ
- ç«çƒæœ¯(Qé”®): è¿œç¨‹æ”»å‡»ï¼Œ3ç§’å†·å´
- é—ªçƒ(Fé”®): ç¬ç§»æŠ€èƒ½ï¼Œ5ç§’å†·å´

// æ“ä½œæ–¹å¼
- å·¦é”®: ç§»åŠ¨è§’è‰²
- å³é”®: é‡Šæ”¾é€‰ä¸­çš„æŠ€èƒ½
- å›è½¦: æ‰“å¼€èŠå¤©
```

## å®‰è£…ä¸è¿è¡Œ

### ç¯å¢ƒè¦æ±‚
```bash
Python 3.8+
Redis 6.0+
Node.js (ç”¨äºJavaScriptå‹ç¼©)
```

## å¿«é€Ÿå¼€å§‹
```
### 1. å…‹éš†é¡¹ç›®
git clone <repository-url>
cd tc_acapp-master
```

### 2. å®‰è£…Pythonä¾èµ–
```
pip install django==4.2.24
pip install channels channels-redis
pip install django-redis thrift
```

### 3. å¯åŠ¨Redis
```
redis-server
```
### 4. æ•°æ®åº“è¿ç§»
```
python manage.py migrate
```

### 5. ç¼–è¯‘å‰ç«¯èµ„æº
```
bash scripts/compress_game_js.sh
```

### 6. å¯åŠ¨åŒ¹é…ç³»ç»Ÿ
```
cd match_system/src
python main.py &
```

### 7. å¯åŠ¨DjangoæœåŠ¡å™¨
```
python manage.py runserver
```

## ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### ä½¿ç”¨uWSGIéƒ¨ç½²
```
uwsgi --ini scripts/uwsgi.ini
```

### æ”¶é›†é™æ€æ–‡ä»¶
```
python manage.py collectstatic
```

## é¡¹ç›®äº®ç‚¹

### ğŸ”¥ æŠ€æœ¯å®ç°
1. **å®æ—¶å¤šäººåŒæ­¥**: ä½¿ç”¨WebSocketå®ç°æ¯«ç§’çº§çš„æ¸¸æˆçŠ¶æ€åŒæ­¥
2. **æ™ºèƒ½åŒ¹é…ç®—æ³•**: åŸºäºç©å®¶ç§¯åˆ†å’Œç­‰å¾…æ—¶é—´çš„å¹³è¡¡åŒ¹é…æœºåˆ¶
3. **å¾®æœåŠ¡æ¶æ„**: åŒ¹é…ç³»ç»Ÿç‹¬ç«‹éƒ¨ç½²ï¼Œä½¿ç”¨Thrift RPCé€šä¿¡
4. **å‰ç«¯æ¸¸æˆå¼•æ“**: çº¯JavaScriptå®ç°çš„è½»é‡çº§æ¸¸æˆå¼•æ“

### ğŸ¨ ç”¨æˆ·ä½“éªŒ
1. **å“åº”å¼è®¾è®¡**: æ”¯æŒä¸åŒåˆ†è¾¨ç‡çš„è®¾å¤‡é€‚é…
2. **æµç•…åŠ¨ç”»**: Canvasç»˜åˆ¶çš„é«˜å¸§ç‡æ¸¸æˆç”»é¢
3. **å®æ—¶åé¦ˆ**: ä¼¤å®³ç‰¹æ•ˆã€ç²’å­ç³»ç»Ÿã€æŠ€èƒ½å†·å´æ˜¾ç¤º
4. **ç¤¾äº¤åŠŸèƒ½**: æ¸¸æˆå†…å®æ—¶èŠå¤©ç³»ç»Ÿ

### ğŸ“Š æ€§èƒ½ä¼˜åŒ–
1. **Redisç¼“å­˜**: æ¸¸æˆæˆ¿é—´çŠ¶æ€å’Œç©å®¶æ•°æ®ç¼“å­˜
2. **èµ„æºå‹ç¼©**: JavaScriptæ–‡ä»¶è‡ªåŠ¨å‹ç¼©åˆå¹¶
3. **è¿æ¥æ± **: æ•°æ®åº“è¿æ¥å¤ç”¨å’Œä¼˜åŒ–
4. **é™æ€èµ„æº**: CDNåŠ é€Ÿçš„å›¾ç‰‡å’Œå­—ä½“èµ„æº

## æ ¸å¿ƒç®—æ³•

### åŒ¹é…ç®—æ³•
```
def check_match(self, a, b):
    dt = abs(a.score - b.score)
    a_max_dif = a.waiting_time * 50
    b_max_dif = b.waiting_time * 50
    return dt <= a_max_dif and dt <= b_max_dif
```

### ç§¯åˆ†ç³»ç»Ÿ
- è·èƒœ: +10åˆ†
- å¤±è´¥: -5åˆ†
- åŒ¹é…è€ƒè™‘ç§¯åˆ†å·®è·å’Œç­‰å¾…æ—¶é—´

## æŠ€æœ¯é€‰å‹è¯´æ˜

### ä¸ºä»€ä¹ˆé€‰æ‹©Django?
- **å¿«é€Ÿå¼€å‘**: å†…ç½®ç”¨æˆ·è®¤è¯ã€ç®¡ç†åå°
- **WebSocketæ”¯æŒ**: Django Channelsæä¾›å¼‚æ­¥æ”¯æŒ
- **ç”Ÿæ€æˆç†Ÿ**: ä¸°å¯Œçš„ç¬¬ä¸‰æ–¹åº“å’Œéƒ¨ç½²æ–¹æ¡ˆ

### ä¸ºä»€ä¹ˆé€‰æ‹©Canvas?
- **æ€§èƒ½ä¼˜ç§€**: ç¡¬ä»¶åŠ é€Ÿçš„2Dæ¸²æŸ“
- **æ§åˆ¶çµæ´»**: åƒç´ çº§çš„ç»˜åˆ¶æ§åˆ¶
- **å…¼å®¹æ€§å¥½**: ç°ä»£æµè§ˆå™¨å…¨é¢æ”¯æŒ

### ä¸ºä»€ä¹ˆä½¿ç”¨Redis?
- **é«˜æ€§èƒ½**: å†…å­˜æ•°æ®åº“ï¼Œå¾®ç§’çº§å“åº”
- **æ•°æ®ç»“æ„**: æ”¯æŒå¤æ‚çš„æ¸¸æˆçŠ¶æ€å­˜å‚¨
- **æŒä¹…åŒ–**: æ•°æ®å®‰å…¨ä¿éšœ

### å±•ç¤ºçš„æŠ€æœ¯èƒ½åŠ›
1. **å…¨æ ˆå¼€å‘**: å‰åç«¯å®Œæ•´å®ç°
2. **å®æ—¶é€šä¿¡**: WebSocketåŒå‘é€šä¿¡
3. **åˆ†å¸ƒå¼ç³»ç»Ÿ**: å¾®æœåŠ¡æ¶æ„è®¾è®¡
4. **æ€§èƒ½ä¼˜åŒ–**: ç¼“å­˜ã€å‹ç¼©ã€å¼‚æ­¥å¤„ç†
5. **ç”¨æˆ·ä½“éªŒ**: æ¸¸æˆäº¤äº’è®¾è®¡

### å¯æ‰©å±•çš„æŠ€æœ¯æ–¹å‘
- **è´Ÿè½½å‡è¡¡**: Nginxåå‘ä»£ç†
- **å®¹å™¨åŒ–**: Dockeréƒ¨ç½²æ–¹æ¡ˆ
- **ç›‘æ§å‘Šè­¦**: æ¸¸æˆæ•°æ®ç»Ÿè®¡
- **AIæœºå™¨äºº**: æ›´æ™ºèƒ½çš„æ¸¸æˆAI

## åœ¨çº¿ä½“éªŒ

éƒ¨ç½²åœ°å€: `app7581.acapp.acwing.com.cn`

---

**å¼€å‘è€…**: [J.Grigg]  
**å¼€å‘æ—¶é—´**: [2025/9]  
**è”ç³»æ–¹å¼**: [2064747320@qq.com]
